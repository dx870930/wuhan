<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­¦æ±‰4æ—¥æ¼«æ¸¸äº¤äº’å¼æŒ‡å— (AIå¢å¼ºç‰ˆ)</title>
    <!-- Chosen Palette: Urban Oasis -->
    <!-- Application Structure Plan: The application uses a tab-based navigation system to organize information by user intent rather than a simple chronological list. The structure includes: 1) 'è¡Œç¨‹æ¦‚è§ˆ' (Itinerary Overview) as the main view with an interactive accordion for each day and a summary chart. 2) 'ç¾é£Ÿå®å…¸' (Food Guide) as a filterable gallery of all food recommendations. 3) 'å‡ºè¡Œé”¦å›Š' (Travel Tips) for consolidated transport info. This task-oriented architecture allows users to quickly find specific information (e.g., just food, or just day 2's plan) without scrolling through unrelated content, significantly improving usability and exploration efficiency compared to a linear document. -->
    <!-- Visualization & Content Choices: 
        - Itinerary Data -> Goal: Chronological Planning -> Method: Interactive Accordion Cards (HTML/CSS/JS) -> Interaction: Click to expand/collapse day details -> Justification: Compact, engaging, and focuses user attention on one day at a time.
        - Trip Composition -> Goal: High-level Trip Summary -> Method: Doughnut Chart (Chart.js/Canvas) -> Interaction: Hover to see activity category and count -> Justification: Fulfills the Chart.js requirement and provides a quick visual understanding of the trip's character (e.g., historical vs. nature).
        - Food Recommendations -> Goal: Easy Food Discovery -> Method: Filterable Grid of Cards (HTML/CSS/JS) in a dedicated tab -> Interaction: Click filter buttons (e.g., 'å°åƒ', 'æ­£é¤') to dynamically show/hide relevant items -> Justification: Powerful user-driven exploration, much more useful than a static list.
        - Transportation Details -> Goal: Actionable Instructions -> Method: Styled text blocks with distinct visual treatment for metro lines (e.g., `<code>` tag styling) -> Interaction: None needed, focus is on readability -> Justification: Clear visual hierarchy helps users quickly scan for critical travel information.
        - Gemini Itinerary Optimization -> Goal: Add intelligent suggestions -> Method: Button-triggered API call -> Interaction: Click "AIä¼˜åŒ–" button to generate and display suggestions within the day's card -> Justification: Provides actionable, AI-driven value directly in the context of daily planning.
        - Gemini Cultural Context -> Goal: Provide deeper understanding -> Method: Icon-triggered API call -> Interaction: Click sparkle icon next to an attraction to reveal a concise explanation -> Justification: Offers on-demand cultural enrichment without cluttering the main interface.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #F8F5F2; /* Warm Neutral Background */
            color: #383838;
            font-family: 'Helvetica Neue', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', 'Microsoft Yahei', sans-serif;
        }
        .nav-tab {
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        .nav-tab.active {
            color: #0D5C63; /* Deep Teal Accent */
            border-bottom-color: #0D5C63;
        }
        .day-header {
            transition: background-color 0.3s ease;
        }
        .day-details {
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
            max-height: 0;
            overflow: hidden;
        }
        .day-details.open {
            max-height: 2000px; /* Increased for AI content */
        }
        .food-card {
            transition: transform 0.3s ease, opacity 0.5s ease;
        }
        .icon-bg {
            background-color: #E5B18130; /* Subtle Accent Background */
        }
        .metro-line {
            font-family: monospace;
            background-color: #e2e8f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 350px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
        }
        .gemini-btn {
            background-color: #0D5C63;
            color: white;
            transition: background-color 0.3s ease;
        }
        .gemini-btn:hover {
            background-color: #084c54;
        }
        .gemini-btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        .gemini-response {
            background-color: #f0fdfa;
            border-left: 4px solid #0D5C63;
        }
        .cultural-context-icon {
            cursor: pointer;
            display: inline-block;
            margin-left: 8px;
            color: #E5B181;
            font-weight: bold;
            transition: transform 0.2s ease;
        }
        .cultural-context-icon:hover {
            transform: scale(1.2);
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto max-w-5xl p-4 sm:p-6 md:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-[#0D5C63]">æ­¦æ±‰4æ—¥æ¼«æ¸¸æŒ‡å—</h1>
            <p class="text-lg text-gray-600 mt-2">ä¸€ä»½ä¸ºæ‚¨é‡èº«å®šåˆ¶çš„AIå¢å¼ºäº¤äº’å¼æ—…è¡Œæ”»ç•¥</p>
        </header>

        <nav class="flex justify-center border-b border-gray-200 mb-8">
            <button data-tab="overview" class="nav-tab active text-lg font-semibold py-3 px-6 cursor-pointer">è¡Œç¨‹æ¦‚è§ˆ</button>
            <button data-tab="food" class="nav-tab text-lg font-semibold py-3 px-6 cursor-pointer">ç¾é£Ÿå®å…¸</button>
            <button data-tab="transport" class="nav-tab text-lg font-semibold py-3 px-6 cursor-pointer">å‡ºè¡Œé”¦å›Š</button>
        </nav>

        <main>
            <!-- Itinerary Overview Tab -->
            <section id="overview" class="tab-content space-y-8">
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h2 class="text-2xl font-bold text-center text-[#0D5C63] mb-4">æ—…ç¨‹åºæ›²ï¼šæ±ŸåŸå°è±¡</h2>
                    <p class="text-center text-gray-600 mb-6">æœ¬æ¬¡æ—…ç¨‹å°†å¸¦æ‚¨ç©¿æ¢­äºæ­¦æ±‰çš„å†å²ä¸ç°ä»£ä¹‹é—´ï¼Œæ—¢æœ‰åšé‡çš„æ–‡åŒ–åº•è•´ï¼Œä¹Ÿæœ‰è½»æ¾çš„è‡ªç„¶é£å…‰ä¸éƒ½å¸‚æ´»åŠ›ã€‚ä¸‹æ–¹çš„å›¾è¡¨ä¸ºæ‚¨å±•ç¤ºäº†æœ¬æ¬¡æ—…è¡Œçš„æ´»åŠ¨ç±»å‹åˆ†å¸ƒï¼ŒåŠ©æ‚¨å¯¹æ—…ç¨‹æœ‰ä¸€ä¸ªæ•´ä½“çš„å°è±¡ã€‚</p>
                    <div class="chart-container">
                        <canvas id="tripBalanceChart"></canvas>
                    </div>
                </div>

                <div id="itinerary-accordion" class="space-y-4">
                    <!-- Day cards will be injected here by JavaScript -->
                </div>
            </section>

            <!-- Food Guide Tab -->
            <section id="food" class="tab-content hidden">
                 <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h2 class="text-2xl font-bold text-center text-[#0D5C63] mb-4">æ±ŸåŸå¯»å‘³ï¼šç¾é£Ÿå®å…¸</h2>
                    <p class="text-center text-gray-600 mb-6">æ­¦æ±‰æ˜¯ç¾é£Ÿä¹‹éƒ½ï¼Œä»è¿‡æ—©åˆ°å®µå¤œï¼Œç²¾å½©ä¸æ–­ã€‚è¿™é‡Œä¸ºæ‚¨æ±‡é›†äº†è¡Œç¨‹ä¸­æåˆ°çš„æ‰€æœ‰ç¾é£Ÿï¼Œæ‚¨å¯ä»¥æ ¹æ®åˆ†ç±»ç­›é€‰ï¼Œå¿«é€Ÿæ‰¾åˆ°å¿ƒä»ªçš„å‘³é“ã€‚</p>
                    <div id="food-filters" class="flex justify-center gap-2 mb-6 flex-wrap">
                        <button data-filter="all" class="px-4 py-2 bg-[#0D5C63] text-white rounded-full font-semibold shadow-md">å…¨éƒ¨</button>
                        <button data-filter="å°åƒ" class="px-4 py-2 bg-white text-gray-700 rounded-full font-semibold shadow-md">é£å‘³å°åƒ</button>
                        <button data-filter="æ­£é¤" class="px-4 py-2 bg-white text-gray-700 rounded-full font-semibold shadow-md">ç‰¹è‰²æ­£é¤</button>
                    </div>
                    <div id="food-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Food cards will be injected here -->
                    </div>
                </div>
            </section>

            <!-- Transport Guide Tab -->
            <section id="transport" class="tab-content hidden">
                <div class="bg-white p-6 rounded-2xl shadow-lg space-y-6">
                    <h2 class="text-2xl font-bold text-center text-[#0D5C63] mb-4">æ±ŸåŸè„‰ç»œï¼šå‡ºè¡Œé”¦å›Š</h2>
                     <p class="text-center text-gray-600 mb-6">æ­¦æ±‰çš„åœ°é“ç½‘ç»œå››é€šå…«è¾¾ï¼Œæ˜¯æœ¬æ¬¡æ—…è¡Œæœ€é«˜æ•ˆã€ä¾¿æ·çš„äº¤é€šæ–¹å¼ã€‚æœ¬é”¦å›Šä¸ºæ‚¨æ¢³ç†äº†å…³é”®çš„äº¤é€šä¿¡æ¯ï¼ŒåŠ©æ‚¨è½»æ¾å‡ºè¡Œã€‚</p>
                    <div class="p-4 border border-gray-200 rounded-lg">
                        <h3 class="font-bold text-lg text-[#E5B181] mb-2">ğŸ¨ é…’åº—äº¤é€šæ ¸å¿ƒ</h3>
                        <p>æ‚¨çš„é…’åº—ä½äº<strong class="text-[#0D5C63]">ã€æ±Ÿæ±‰è·¯ç«™ã€‘</strong>ï¼Œæ˜¯ <span class="metro-line">åœ°é“2å·çº¿</span> ä¸ <span class="metro-line">åœ°é“6å·çº¿</span> çš„æ¢ä¹˜ç«™ã€‚ä»è½¦ç«™çš„ <strong class="text-[#0D5C63]">Hå£</strong> æˆ– <strong class="text-[#0D5C63]">Jå£</strong> å‡ºç«™ï¼Œå³å¯è½»æ¾æŠµè¾¾é…’åº—ã€‚</p>
                    </div>
                    <div class="p-4 border border-gray-200 rounded-lg">
                        <h3 class="font-bold text-lg text-[#E5B181] mb-2">ğŸš‰ ä¸»è¦ç«™ç‚¹ä¸€è§ˆ</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li><strong>æ±‰å£ç«è½¦ç«™ â†’ é…’åº—ï¼š</strong>ä¹˜å <span class="metro-line">åœ°é“2å·çº¿</span> ç›´è¾¾ã€æ±Ÿæ±‰è·¯ç«™ã€‘ã€‚</li>
                            <li><strong>å‰å¾€é»„é¹¤æ¥¼ï¼š</strong>ä»ã€æ±Ÿæ±‰è·¯ç«™ã€‘ä¹˜ <span class="metro-line">åœ°é“6å·çº¿</span> æ¢ä¹˜ <span class="metro-line">åœ°é“5å·çº¿</span> è‡³ã€å¸é—¨å£é»„é¹¤æ¥¼ç«™ã€‘ã€‚</li>
                            <li><strong>å‰å¾€å…‰è°·ï¼š</strong>ä»æ­¦æ˜Œå¤åŸï¼ˆå¦‚ã€ç§¯ç‰æ¡¥ç«™ã€‘ï¼‰ä¹˜å <span class="metro-line">åœ°é“2å·çº¿</span> å‰å¾€ã€å…‰è°·å¹¿åœºç«™ã€‘ã€‚</li>
                            <li><strong>å‰å¾€å¤å¾·å¯ºï¼š</strong>ä»ã€æ±Ÿæ±‰è·¯ç«™ã€‘ä¹˜ <span class="metro-line">åœ°é“2å·çº¿</span> æ¢ä¹˜ <span class="metro-line">åœ°é“1å·çº¿</span> è‡³ã€å¤´é“è¡—ç«™ã€‘ã€‚</li>
                        </ul>
                    </div>
                     <div class="p-4 border border-gray-200 rounded-lg bg-teal-50">
                        <h3 class="font-bold text-lg text-[#E5B181] mb-2">ğŸ’¡ æ¸©é¦¨æç¤º</h3>
                        <p class="text-gray-700">å»ºè®®ä½¿ç”¨æ”¯ä»˜å®æˆ–å¾®ä¿¡çš„ä¹˜è½¦ç åŠŸèƒ½ï¼Œæˆ–åŠç†ä¸€å¼ â€œæ­¦æ±‰é€šâ€äº¤é€šå¡ï¼Œæ–¹ä¾¿ä¹˜ååœ°é“å’Œå…¬äº¤ã€‚æ­¦æ±‰çš„æ™¯ç‚¹é—´è·è¾ƒå¤§ï¼Œåˆç†åˆ©ç”¨åœ°é“å°†æå¤§èŠ‚çœæ‚¨çš„æ—¶é—´å’Œä½“åŠ›ã€‚</p>
                    </div>
                </div>
            </section>
        </main>

        <footer class="text-center text-gray-500 mt-12">
            <p>&copy; 2025 äº¤äº’å¼æ—…è¡Œæ”»ç•¥</p>
        </footer>

    </div>

    <script>
        const itineraryData = {
            days: [
                {
                    day: 1,
                    title: "æŠµè¾¾ä¸æ±ŸåŸåˆå°è±¡",
                    theme: "æ„Ÿå—ç™¾å¹´å•†ä¸šè¡—çš„ç¹åä¸é•¿æ±Ÿçš„å£®é˜”ã€‚",
                    schedule: [
                        { time: "ä¸Šåˆ", activity: "æŠµè¾¾æ±‰å£ç«è½¦ç«™ï¼Œå‰å¾€é…’åº—åŠç†å…¥ä½ï¼Œç¨ä½œä¼‘æ•´ã€‚" },
                        { time: "ä¸‹åˆ", activity: "é—²é€›æ±Ÿæ±‰è·¯æ­¥è¡Œè¡—ï¼Œä¹‹åæ­¥è¡Œå‰å¾€é»é»„é™‚è·¯ï¼Œæ„Ÿå—â€œè¡—å¤´åšç‰©é¦†â€çš„æ–‡è‰ºæ°”æ¯ã€‚", cultural: "é»é»„é™‚è·¯" },
                        { time: "æ™šä¸Š", activity: "æ­¥è¡Œè‡³æ±‰å£æ±Ÿæ»©ï¼Œä¹˜åé•¿æ±Ÿæ¸¸èˆ¹ï¼Œæ¬£èµå£®ä¸½çš„é•¿æ±Ÿç¯å…‰ç§€å’Œä¸¤å²¸å¤œæ™¯ã€‚" }
                    ],
                    transport: "ä»Šæ—¥è¡Œç¨‹å‡åœ¨é…’åº—æ­¥è¡ŒèŒƒå›´å†…ï¼Œæ— éœ€ä¹˜åå…¬å…±äº¤é€šã€‚",
                    food: [
                        { name: "è”¡æ—è®°", desc: "å“å°æ‹›ç‰Œçƒ­å¹²é¢ã€ä¸‰é²œè±†çš®ã€‚", type: "å°åƒ" },
                        { name: "ä¸¥æ°çƒ§éº¦", desc: "ï¼ˆå‰è¿›äº”è·¯åº—ï¼‰å“å°é‡æ²¹èƒ¡æ¤’çƒ§éº¦ã€‚", type: "å°åƒ" }
                    ]
                },
                {
                    day: 2,
                    title: "å†å²ä¸æœªæ¥çš„è·¨è¶Š",
                    theme: "ç™»ä¸´åæ¥¼ï¼Œä½“éªŒæœªæ¥ç§‘æŠ€ã€‚",
                    schedule: [
                        { time: "ä¸Šåˆ", activity: "ç™»ä¸´é»„é¹¤æ¥¼ã€‚", cultural: "é»„é¹¤æ¥¼" },
                        { time: "ä¸­åˆ", activity: "åœ¨æˆ·éƒ¨å··äº«ç”¨åˆé¤ï¼Œå“å°å„ç±»åœ°é“å°åƒã€‚" },
                        { time: "ä¸‹åˆ", activity: "ä¹‹åæ­¥è¡Œå‰å¾€æ˜™åæ—æ–‡è‰ºè¡—åŒºé—²é€›ã€‚", cultural: "æ˜™åæ—" },
                        { time: "ä¸‹åˆ", activity: "å‰å¾€å…‰è°·ï¼Œä½“éªŒæ–°æ½®çš„å…‰è°·ç©ºè½¨ã€‚", cultural: "å…‰è°·ç©ºè½¨" }
                    ],
                    transport: "ä¸Šåˆæ¸¸è§ˆåï¼Œéœ€ä»æˆ·éƒ¨å··æˆ–æ˜™åæ—é™„è¿‘ä¹˜å<span class='metro-line'>åœ°é“2å·çº¿</span>ï¼ˆä»ç§¯ç‰æ¡¥ç«™ä¸Šè½¦ï¼‰å‰å¾€å…‰è°·å¹¿åœºç«™ï¼ˆè½¦ç¨‹çº¦45-60åˆ†é’Ÿï¼‰ã€‚æ™šé¤åœ°ç‚¹ä¹Ÿåœ¨å…‰è°·ï¼Œè¡Œç¨‹è¿è´¯ã€‚",
                    food: [
                        { name: "æˆ·éƒ¨å··å°åƒ", desc: "å“å°å¾å«‚ç³Šæ±¤ç²‰ã€ä½•è®°è±†çš®ç­‰ã€‚", type: "å°åƒ" },
                        { name: "é“é“è’¸è™¾", desc: "ï¼ˆå…‰è°·åº·æ¡¥å°åŒºåº—ï¼‰æ™šé¤å¯åœ¨æ­¤å“å°æ­¦æ±‰æœ€å—æ¬¢è¿çš„å°é¾™è™¾ä¹‹ä¸€ã€‚", type: "æ­£é¤" }
                    ]
                },
                {
                    day: 3,
                    title: "æ–‡æ•™åº•è•´ä¸æ¹–å…‰å±±è‰²",
                    theme: "åœ¨ç™¾å¹´å­¦åºœä¸æµ©æ¸ºä¸œæ¹–é—´ï¼Œäº«å—æ‚ é—²çš„ä¸€å¤©ã€‚",
                    schedule: [
                        { time: "ä¸Šåˆ", activity: "æ¸¸è§ˆæ­¦æ±‰å¤§å­¦ã€‚", cultural: "æ­¦æ±‰å¤§å­¦" },
                        { time: "ä¸­åˆ", activity: "åœ¨æ­¦æ±‰å¤§å­¦é™„è¿‘äº«ç”¨åˆé¤ã€‚" },
                        { time: "ä¸‹åˆ", activity: "æ¼«æ­¥æˆ–éª‘è¡Œäºæ•´ä¸ªä¸œæ¹–é£æ™¯åŒºã€‚" },
                        { time: "æ™šä¸Š", activity: "åœ¨æ­¦å¤§æˆ–ä¸œæ¹–é™„è¿‘å“å°å°åƒï¼Œä¹‹å18:30å‚è§‚æ¹–åŒ—çœåšç‰©é¦†ã€‚", cultural: "æ¹–åŒ—çœåšç‰©é¦†" }
                    ],
                    transport: "ä»ã€æ±Ÿæ±‰è·¯ç«™ã€‘ä¹˜å<span class='metro-line'>åœ°é“2å·çº¿</span>è‡³ã€è¡—é“å£ç«™ã€‘æˆ–ã€å¹¿åŸ å±¯ç«™ã€‘å‰å¾€æ­¦å¤§ã€‚æœ¬æ—¥æ‰€æœ‰æ™¯ç‚¹å‡åœ¨ä¸œæ¹–ç‰‡åŒºï¼Œæ­¥è¡Œæˆ–éª‘è¡Œå³å¯è½»æ¾è¿æ¥ã€‚",
                    food: [
                        { name: "æ±Ÿå—å°è§‚å›­", desc: "ï¼ˆæ­¦å¤§åº—ï¼‰è¢«èª‰ä¸ºâ€œæ­¦å¤§æ ¡å¤–é£Ÿå ‚â€ï¼Œå¯åœ¨æ­¤äº«ç”¨åˆé¤ï¼Œå“å°åœ°é“æ¹–åŒ—èœã€‚", type: "æ­£é¤" },
                        { name: "æ­¦å¤§å‘¨è¾¹å°åƒ", desc: "ççˆå±±ã€å¹¿å…«è·¯é™„è¿‘æœ‰ä¼—å¤šå°åƒæ‘Šç‚¹ï¼Œæ™šé¤å¯åœ¨æ­¤è§£å†³ã€‚", type: "å°åƒ" }
                    ]
                },
                {
                    day: 4,
                    title: "å¼‚åŸŸé£æƒ…ä¸å‘Šåˆ«",
                    theme: "åœ¨ç‹¬ç‰¹çš„å¤å¯ºä¸­æ„Ÿå—å®é™ï¼Œå¸¦ç€æ»¡æ»¡çš„å›å¿†è¿”ç¨‹ã€‚",
                    schedule: [
                        { time: "ä¸Šåˆ", activity: "å‰å¾€æ±‰å£åŒºçš„å¤å¾·å¯ºå‚è§‚ï¼Œæ„Ÿå—å…¶ç‹¬ç‰¹çš„å¼‚åŸŸå»ºç­‘é£æ ¼ã€‚", cultural: "å¤å¾·å¯º" },
                        { time: "ä¸­åˆ", activity: "ä»å¤å¾·å¯ºè¿”å›é…’åº—ï¼ŒåŠç†é€€æˆ¿æ‰‹ç»­ã€‚æ‚¨å¯å°†è¡Œæå¯„å­˜åœ¨é…’åº—ï¼Œåœ¨æ±Ÿæ±‰è·¯é™„è¿‘äº«ç”¨åˆé¤æˆ–è´­ä¹°ä¼´æ‰‹ç¤¼ã€‚" },
                        { time: "ä¸‹åˆ", activity: "ä»é…’åº—å–å›è¡Œæï¼Œå‰å¾€æ±‰å£ç«è½¦ç«™è¿”ç¨‹ã€‚" }
                    ],
                    transport: "ä»ã€æ±Ÿæ±‰è·¯ç«™ã€‘ä¹˜å<span class='metro-line'>åœ°é“2å·çº¿</span>æ¢ä¹˜<span class='metro-line'>åœ°é“1å·çº¿</span>è‡³ã€å¤´é“è¡—ç«™ã€‘ï¼Œå‡ºç«™åæ­¥è¡Œæˆ–éª‘è¡Œä¸€å°æ®µè·ç¦»å³å¯åˆ°è¾¾ã€‚å‚è§‚ååŸè·¯è¿”å›é…’åº—ã€‚",
                    food: [
                        { name: "æ±Ÿæ±‰è·¯å‘¨è¾¹", desc: "åœ¨ç¦»å¼€å‰ï¼Œå¯ä»¥åœ¨æ±Ÿæ±‰è·¯é™„è¿‘å†å“å°ä¸€æ¬¡å¿ƒä»ªçš„æ­¦æ±‰å°åƒæˆ–é€‰æ‹©ä¸€å®¶é¤å…ç”¨é¤ã€‚", type: "å°åƒ" }
                    ]
                }
            ]
        };

        document.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.nav-tab');
            const contents = document.querySelectorAll('.tab-content');
            const accordionContainer = document.getElementById('itinerary-accordion');
            const foodGrid = document.getElementById('food-grid');
            const foodFilters = document.getElementById('food-filters');

            async function callGemini(prompt, button, responseContainer) {
                const originalButtonText = button.innerHTML;
                const isIconButton = button.tagName !== 'BUTTON';
                
                if(!isIconButton) {
                    button.disabled = true;
                    button.innerHTML = 'AIæ­£åœ¨æ€è€ƒä¸­...';
                } else {
                    button.innerHTML = '...';
                }
                responseContainer.classList.add('hidden');

                const apiKey = ""; // Leave as-is
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }]
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        responseContainer.innerHTML = text.replace(/\n/g, '<br>');
                        responseContainer.classList.remove('hidden');
                    } else {
                        responseContainer.innerHTML = 'æŠ±æ­‰ï¼ŒAIæš‚æ—¶æ— æ³•æä¾›å»ºè®®ï¼Œè¯·ç¨åå†è¯•ã€‚';
                        responseContainer.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error('Gemini API call failed:', error);
                    responseContainer.innerHTML = 'ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥æˆ–ç¨åå†è¯•ã€‚';
                    responseContainer.classList.remove('hidden');
                } finally {
                     if(!isIconButton) {
                        button.disabled = false;
                        button.innerHTML = originalButtonText;
                    } else {
                        button.innerHTML = 'âœ¨';
                    }
                }
            }


            function renderItinerary() {
                accordionContainer.innerHTML = ''; // Clear existing content before re-rendering
                itineraryData.days.forEach(dayData => {
                    const scheduleHtml = dayData.schedule.map(item => {
                        let culturalIcon = '';
                        if (item.cultural) {
                            culturalIcon = `<span class="cultural-context-icon" title="äº†è§£â€œ${item.cultural}â€çš„æ–‡åŒ–èƒŒæ™¯" data-attraction="${item.cultural}">âœ¨</span>`;
                        }
                        return `
                        <div class="flex items-start">
                            <span class="font-bold text-[#E5B181] w-16 flex-shrink-0">${item.time}</span>
                            <p class="text-gray-700">${item.activity}${culturalIcon}</p>
                        </div>
                        <div class="pl-16 hidden gemini-response" data-attraction-response="${item.cultural}"></div>
                        `;
                    }).join('');
                    
                    const foodHtml = dayData.food.map(item => `
                        <div class="flex items-start">
                            <span class="font-semibold text-[#0D5C63] w-32 flex-shrink-0">${item.name}</span>
                            <p class="text-gray-600">${item.desc}</p>
                        </div>
                    `).join('');

                    const dayCard = `
                        <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                            <div class="day-header p-5 cursor-pointer flex justify-between items-center bg-white hover:bg-gray-50" data-day="${dayData.day}">
                                <div>
                                    <h3 class="text-xl font-bold text-[#0D5C63]">ç¬¬ ${dayData.day} å¤©ï¼š${dayData.title}</h3>
                                    <p class="text-gray-500">${dayData.theme}</p>
                                </div>
                                <svg class="w-6 h-6 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </div>
                            <div class="day-details px-5">
                                <div class="py-5 border-t border-gray-200 space-y-4">
                                    <div class="flex items-center gap-3"><span class="icon-bg p-2 rounded-full">ğŸ—“ï¸</span><h4 class="font-bold text-lg">è¡Œç¨‹å®‰æ’</h4></div>
                                    <div class="pl-10 space-y-2">${scheduleHtml}</div>
                                    
                                    <div class="flex items-center gap-3 pt-4"><span class="icon-bg p-2 rounded-full">ğŸš‡</span><h4 class="font-bold text-lg">äº¤é€šæŒ‡å—</h4></div>
                                    <p class="pl-10 text-gray-700">${dayData.transport}</p>
                                    
                                    <div class="flex items-center gap-3 pt-4"><span class="icon-bg p-2 rounded-full">ğŸœ</span><h4 class="font-bold text-lg">ç¾é£Ÿæ¨è</h4></div>
                                    <div class="pl-10 space-y-2">${foodHtml}</div>

                                    <div class="pt-6 text-center">
                                        <button class="gemini-btn px-4 py-2 rounded-full font-semibold shadow-md optimize-btn" data-day="${dayData.day}">âœ¨ AIä¼˜åŒ–å»ºè®®</button>
                                        <div class="gemini-response p-4 mt-4 text-left rounded-lg hidden" data-optimize-response="${dayData.day}"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    accordionContainer.innerHTML += dayCard;
                });
            }
            
            function renderFoodGuide(filter = 'all') {
                foodGrid.innerHTML = '';
                let allFood = [];
                if (filter === 'all') {
                    itineraryData.days.forEach(day => allFood.push(...day.food));
                } else {
                    itineraryData.days.forEach(day => {
                        allFood.push(...day.food.filter(f => f.type === filter));
                    });
                }
                
                const uniqueFood = Array.from(new Set(allFood.map(a => a.name)))
                    .map(name => {
                        return allFood.find(a => a.name === name)
                    });

                uniqueFood.forEach(food => {
                    const foodCard = `
                        <div class="food-card bg-gray-50 p-4 rounded-xl border border-gray-200">
                            <h4 class="font-bold text-lg text-[#0D5C63]">${food.name}</h4>
                            <p class="text-gray-600 mb-2">${food.desc}</p>
                            <span class="text-sm font-semibold text-white bg-[#E5B181] px-2 py-1 rounded-full">${food.type}</span>
                        </div>
                    `;
                    foodGrid.innerHTML += foodCard;
                });
            }

            function renderChart() {
                const ctx = document.getElementById('tripBalanceChart').getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['å†å²äººæ–‡', 'è‡ªç„¶é£å…‰', 'ç°ä»£éƒ½å¸‚', 'ç¾é£Ÿä½“éªŒ'],
                        datasets: [{
                            label: 'æ´»åŠ¨æ•°é‡',
                            data: [5, 2, 1, 5], 
                            backgroundColor: [
                                '#E5B181', // Historical
                                '#6B8E23', // Nature
                                '#4682B4', // Modern
                                '#CD5C5C'  // Food
                            ],
                            borderColor: '#F8F5F2',
                            borderWidth: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: { size: 14 }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    title: function(tooltipItems) {
                                        const item = tooltipItems[0];
                                        let label = item.chart.data.labels[item.dataIndex];
                                        if (Array.isArray(label)) {
                                            return label.join(' ');
                                        }
                                        return label;
                                    },
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        label += context.raw + 'é¡¹æ´»åŠ¨';
                                        return label;
                                    }
                                }
                            }
                        },
                        cutout: '60%'
                    }
                });
            }

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    contents.forEach(content => {
                        if (content.id === tab.dataset.tab) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });
                });
            });
            
            accordionContainer.addEventListener('click', (e) => {
                const header = e.target.closest('.day-header');
                if (header) {
                    const details = header.nextElementSibling;
                    const icon = header.querySelector('svg');
                    details.classList.toggle('open');
                    icon.classList.toggle('rotate-180');
                    return;
                }

                if (e.target.classList.contains('optimize-btn')) {
                    const day = e.target.dataset.day;
                    const dayData = itineraryData.days.find(d => d.day == day);
                    const scheduleText = dayData.schedule.map(s => `${s.time}: ${s.activity}`).join('; ');
                    const prompt = `æˆ‘æ˜¯ä¸€åæ¸¸å®¢ï¼Œè¿™æ˜¯æˆ‘ç¬¬${day}å¤©çš„æ­¦æ±‰è¡Œç¨‹è®¡åˆ’ï¼š${scheduleText}ã€‚ä¸»é¢˜æ˜¯â€œ${dayData.theme}â€ã€‚è¯·åŸºäºè¿™ä¸ªè®¡åˆ’ï¼Œç”¨ä¸­æ–‡ç»™æˆ‘æä¾›1-2æ¡å…·ä½“çš„ä¼˜åŒ–å»ºè®®ï¼Œæ¯”å¦‚å¢åŠ ä¸€ä¸ªé¡ºè·¯çš„å°ä¼—æ™¯ç‚¹ï¼Œæˆ–è€…è°ƒæ•´ä¸€ä¸‹é¡ºåºè®©è·¯çº¿æ›´åˆç†ã€‚ä¿æŒå›å¤ç®€æ´ï¼Œç›´æ¥ç»™å‡ºå»ºè®®å³å¯ã€‚`;
                    const responseContainer = document.querySelector(`div[data-optimize-response="${day}"]`);
                    callGemini(prompt, e.target, responseContainer);
                }

                if (e.target.classList.contains('cultural-context-icon')) {
                    const attraction = e.target.dataset.attraction;
                    const prompt = `è¯·ç”¨ä¸­æ–‡ï¼Œç®€æ´ç”ŸåŠ¨åœ°ä»‹ç»ä¸€ä¸‹æ­¦æ±‰â€œ${attraction}â€çš„æ–‡åŒ–èƒŒæ™¯æˆ–ä¸»è¦çœ‹ç‚¹ï¼Œå¤§çº¦50-100å­—å³å¯ã€‚`;
                    const responseContainer = e.target.parentElement.nextElementSibling;
                    const dummyButton = e.target; // Use the icon as a dummy button for state
                    callGemini(prompt, dummyButton, responseContainer);
                }
            });

            foodFilters.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    const filter = e.target.dataset.filter;
                    renderFoodGuide(filter);
                    document.querySelectorAll('#food-filters button').forEach(btn => {
                        btn.classList.remove('bg-[#0D5C63]', 'text-white');
                        btn.classList.add('bg-white', 'text-gray-700');
                    });
                    e.target.classList.add('bg-[#0D5C63]', 'text-white');
                    e.target.classList.remove('bg-white', 'text-gray-700');
                }
            });

            renderItinerary();
            renderFoodGuide();
            renderChart();
        });
    </script>
</body>
</html>
